<div class="page-container dark-theme gestione-operatori-page">
  <header class="page-header">
    <h1><i class="fas fa-users-cog"></i> Gestione Utenti e Operatori</h1>
  </header>

  <section class="action-bar">
    <div class="search-container">
      <input 
        type="text" 
        placeholder="Cerca per nome o email..." 
        class="search-input dark-input"
        [(ngModel)]="searchTerm"
        (input)="filtraUtenti()">
      <button class="btn btn-primary btn-search"><i class="fas fa-search"></i></button>
    </div>
    <button class="btn btn-primary btn-add-operator" (click)="apriModaleAggiungi()">
      <i class="fas fa-user-plus"></i> Aggiungi Operatore
    </button>
  </section>

  <section class="content-area">
    <div class="table-responsive-container">
      <table class="data-table dark-table operators-table">
        <thead>
          <tr>
            <th>Nome Completo</th>
            <th>Email (Username)</th>
            <th>Ruolo</th>
            <th>Data Creazione</th>
            <th class="actions-column">Azioni</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let utente of utentiFiltrati; trackBy: trackById">
            <td>{{ utente.nomeCompleto }}</td>
            <td>{{ utente.email }}</td>
            <td>
              <span class="role-badge" [ngClass]="{'role-operator': utente.ruolo === 'Operatore', 'role-user': utente.ruolo === 'Utente'}">
                {{ utente.ruolo }}
              </span>
            </td>
            <td>{{ utente.dataCreazione }}</td>
            <td class="actions-cell">
              <button class="btn btn-table-action btn-edit" title="Modifica Utente" (click)="apriModaleModifica(utente)">
                <i class="fas fa-edit"></i> <span class="btn-action-text">Modifica</span>
              </button>
              <button class="btn btn-table-action btn-delete" title="Elimina Utente" (click)="apriModaleElimina(utente)">
                <i class="fas fa-trash"></i> <span class="btn-action-text">Elimina</span>
              </button>
            </td>
          </tr>
          <tr *ngIf="utentiFiltrati.length === 0">
              <td colspan="5" style="text-align: center; padding: 20px;">Nessun utente trovato.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <footer class="backoffice-page-footer dark-theme">
    <p>&copy; 2025 Bike Rental System - Backoffice</p>
  </footer>
</div>

<!-- Modale Aggiungi/Modifica -->
<div class="modal-overlay" *ngIf="isAddModalOpen || isEditModalOpen" (click)="chiudiModali()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 *ngIf="isAddModalOpen"><i class="fas fa-user-plus"></i> Aggiungi Nuovo Operatore</h2>
      <h2 *ngIf="isEditModalOpen"><i class="fas fa-edit"></i> Modifica Utente</h2>
      <button class="btn-close-modal" (click)="chiudiModali()">&times;</button>
    </div>
    <form (ngSubmit)="isAddModalOpen ? aggiungiOperatore() : salvaModificheUtente()">
      <div class="modal-body">
        <!-- Campi per Aggiungere Operatore -->
        <ng-container *ngIf="isAddModalOpen">
          <div class="form-group">
            <label for="add-nome">Nome Completo</label>
            <input id="add-nome" type="text" [(ngModel)]="nuovoUtente.nomeCompleto" name="add-nome" required>
          </div>
          <div class="form-group">
            <label for="add-email">Email</label>
            <input id="add-email" type="email" [(ngModel)]="nuovoUtente.email" name="add-email" required>
          </div>
           <div class="form-group">
            <label for="add-password">Password</label>
            <input id="add-password" type="password" [(ngModel)]="nuovoUtente.password" name="add-password" required>
          </div>
        </ng-container>

        <!-- Campi per Modificare Utente -->
        <ng-container *ngIf="isEditModalOpen && utenteDaModificare">
          <div class="form-group">
            <label for="edit-nome">Nome Completo</label>
            <input id="edit-nome" type="text" [(ngModel)]="utenteDaModificare.nomeCompleto" name="edit-nome" required>
          </div>
          <div class="form-group">
            <label for="edit-email">Email</label>
            <input id="edit-email" type="email" [(ngModel)]="utenteDaModificare.email" name="edit-email" required>
          </div>
          <div class="form-group">
            <label for="edit-ruolo">Ruolo</label>
            <select id="edit-ruolo" [(ngModel)]="utenteDaModificare.ruolo" name="edit-ruolo">
              <option value="Operatore">Operatore</option>
              <option value="Utente">Utente</option>
            </select>
          </div>
        </ng-container>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="chiudiModali()">Annulla</button>
        <button type="submit" class="btn btn-primary">{{ isAddModalOpen ? 'Aggiungi' : 'Salva Modifiche' }}</button>
      </div>
    </form>
  </div>
</div>

<!-- Modale Conferma Eliminazione -->
<div class="modal-overlay" *ngIf="isDeleteModalOpen" (click)="chiudiModali()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-exclamation-triangle"></i> Conferma Eliminazione</h2>
      <button class="btn-close-modal" (click)="chiudiModali()">&times;</button>
    </div>
    <div class="modal-body">
      <p *ngIf="utenteDaEliminare">
        Sei sicuro di voler eliminare l'utente <strong>{{ utenteDaEliminare.nomeCompleto }}</strong>?
        <br>L'azione Ã¨ irreversibile.
      </p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="chiudiModali()">Annulla</button>
      <button type="button" class="btn btn-delete" (click)="confermaEliminazione()">Elimina</button>
    </div>
  </div>
</div>
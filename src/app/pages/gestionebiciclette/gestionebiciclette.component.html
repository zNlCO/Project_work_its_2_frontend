<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Gestione Modelli Bici</h2>
    <button class="btn btn-primary" (click)="openAdd()">
      <i class="fas fa-plus me-1"></i> Aggiungi modello
    </button>
  </div>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    <div class="col" *ngFor="let model of bikeModels">
      <div class="card h-100 shadow-sm">
        <img
          [src]="model.imgUrl"
          class="card-img-top"
          [alt]="model.descrizione"
          style="object-fit: cover; height: 180px"
        />
        <div class="card-body">
          <h5 class="card-title">
            {{ model.type }}
            <span class="badge bg-secondary ms-2">{{ model.size }}</span>
          </h5>
          <div class="mb-2 text-muted">{{ model.descrizione }}</div>
          <div>
            <span
              class="badge"
              [ngClass]="model.elettrica ? 'bg-success' : 'bg-secondary'"
            >
              {{ model.elettrica ? "Elettrica" : "Muscolare" }}
            </span>
          </div>
          <div class="mt-2 fw-bold text-danger">
            €{{ model.prezzo | number : "1.2-2" }}
            <span class="text-secondary">/ora</span>
          </div>
        </div>
        <div class="card-footer d-flex justify-content-end gap-2">
          <button
            class="btn btn-outline-primary btn-sm"
            (click)="openEdit(model)"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            class="btn btn-outline-danger btn-sm"
            (click)="delete(model._id)"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  *ngIf="showModal"
  class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
  style="background: rgba(0, 0, 0, 0.5); z-index: 2000"
>
  <div
    class="bg-white rounded-4 shadow-lg p-4 position-relative"
    style="min-width: 340px; max-width: 95vw"
  >
    <button
      type="button"
      class="btn position-absolute top-0 end-0 m-2 p-0"
      style="
        font-size: 2rem;
        line-height: 1;
        color: #dc3545;
        background: none;
        border: none;
      "
      aria-label="Chiudi"
      (click)="showModal = false"
    >
      &times;
    </button>
    <h5 class="mb-3">
      {{ isEditMode ? "Modifica" : "Aggiungi" }} Modello Bici
    </h5>
    <form (ngSubmit)="save()">
      <div class="mb-3">
        <label class="form-label">Descrizione *</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="currentModel.descrizione"
          name="descrizione"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Tipo *</label>
        <select
          class="form-select"
          [(ngModel)]="currentModel.type"
          name="type"
          required
        >
          <option value="" disabled selected>Seleziona tipo</option>
          <option *ngFor="let t of bikeTypes" [value]="t">{{ t }}</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Taglia *</label>
        <select
          class="form-select"
          [(ngModel)]="currentModel.size"
          name="size"
          required
        >
          <option *ngFor="let s of availableSizes" [value]="s">{{ s }}</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Elettrica *</label>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            [(ngModel)]="currentModel.elettrica"
            [value]="true"
            name="elettrica"
            required
          />
          <label class="form-check-label">Sì</label>
        </div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            [(ngModel)]="currentModel.elettrica"
            [value]="false"
            name="elettrica"
          />
          <label class="form-check-label">No</label>
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Prezzo Orario (€) *</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="currentModel.prezzo"
          name="prezzo"
          min="0"
          step="0.01"
          required
        />
      </div>
      <div class="mb-3">
        <label class="form-label">URL Immagine *</label>
        <input
          type="url"
          class="form-control"
          [(ngModel)]="currentModel.imgUrl"
          name="imgUrl"
          required
        />
      </div>
      <div class="d-flex justify-content-end">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="
            !currentModel.descrizione ||
            !currentModel.type ||
            !currentModel.size ||
            currentModel.elettrica === undefined ||
            !currentModel.prezzo ||
            !currentModel.imgUrl
          "
        >
          {{ isEditMode ? "Salva Modifiche" : "Aggiungi" }}
        </button>
      </div>
    </form>
  </div>
</div>

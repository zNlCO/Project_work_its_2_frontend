<div class="container py-5">
    <!-- Step Indicator -->
    <div class="d-flex justify-content-center mb-4">
        <div class="step-circle me-3" [ngClass]="{ 'active-step': currentStep === 1 }">1</div>
        <div class="step-circle" [ngClass]="{ 'active-step': currentStep === 2 }">2</div>
    </div>

    <!-- Step 1 -->
    <div *ngIf="currentStep === 1">
        <!-- Luogo di ritiro -->
        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Luogo di ritiro</label>
            <select class="form-select" [(ngModel)]="pickupLocation" name="pickupLocation"
                (ngModelChange)="autoFillDropoff()" required>
                <option value="" disabled selected>Seleziona luogo di ritiro</option>
                <option *ngFor="let store of stores" [value]="store._id">{{ store.location }}</option>
            </select>
        </div>

        <!-- Luogo di consegna -->
        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Luogo di consegna</label>
            <select class="form-select" [(ngModel)]="dropoffLocation">
                <option *ngFor="let store of stores" [value]="store._id">{{ store.location }}</option>
            </select>
        </div>

        <!-- Data e ora di ritiro -->
        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Data di ritiro</label>
            <input type="date" class="form-control" [(ngModel)]="pickupDate" (change)="checkDates()">
        </div>

        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Ora di ritiro</label>
            <select class="form-select" [(ngModel)]="pickupTime" (change)="checkDates()">
                <option *ngFor="let hour of hours" [value]="hour">{{ hour }}</option>
            </select>
        </div>

        <!-- Data e ora di consegna -->
        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Data di consegna</label>
            <input type="date" class="form-control" [(ngModel)]="dropoffDate" (change)="checkDates()">
        </div>

        <div class="mb-3">
            <label class="form-label bai-jamjuree-semibold text-black">Ora di consegna</label>
            <select class="form-select" [(ngModel)]="dropoffTime" (change)="checkDates()">
                <option *ngFor="let hour of hours" [value]="hour">{{ hour }}</option>
            </select>
        </div>

        <!-- Messaggio di errore -->
        <div *ngIf="invalidDateRange" class="alert alert-danger p-2">
            La data e l'ora di consegna devono essere successive a quelle di ritiro.
        </div>

        <!-- Pulsante continua -->
        <div class="text-end">
            <button class="btn my-red-btn bai-jamjuree-semibold mt-3"
                [disabled]="!pickupLocation || !dropoffLocation || !pickupDate || !dropoffDate || !pickupTime || !dropoffTime || invalidDateRange"
                (click)="goToStep(2)">Continua</button>
        </div>
    </div>

    <!-- Step 2 -->
    <div *ngIf="currentStep === 2">
        <div class="container py-4">
            <div class="row bg-light rounded shadow p-4 mb-4">
                <!-- Riepilogo dati prima tab -->
                <div class="col-12 mb-3">
                    <h5 class="bai-jamjuree-semibold">Dati prenotazione</h5>
                    <p class="mb-1"><strong>Luogo ritiro:</strong> {{ pickupLocation }}</p>
                    <p class="mb-1"><strong>Luogo consegna:</strong> {{ dropoffLocation }}</p>
                    <p class="mb-1"><strong>Data ritiro:</strong> {{ pickupDate }} ore {{ pickupTime }}</p>
                    <p class="mb-1"><strong>Data consegna:</strong> {{ dropoffDate }} ore {{ dropoffTime }}</p>
                </div>

                <!-- Dettagli bici -->
                <!--
                <div class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0">
                    <img [src]="bikeImageUrl" alt="Immagine bici" class="img-fluid rounded"
                        style="max-height: 200px;" />
                </div>


                <div class="col-md-8">
                    <h5 class="bai-jamjuree-semibold mb-2">{{ bikeModel }}</h5>
                    <p class="mb-1"><strong>Taglia:</strong> {{ bikeSize }}</p>
                    <p class="mb-1"><strong>Assicurazione:</strong> {{ insuranceSelected ? 'Sì' : 'No' }}</p>
                    <p class="mb-3"><strong>Accessori:</strong> {{ accessories.length > 0 ? accessories.join(', ') :
                        'Nessuno' }}</p>

                    <div class="text-end">
                        <h5 class="bai-jamjuree-semibold text-danger">Totale: € {{ totalPrice.toFixed(2) }}</h5>
                    </div>
                </div>
                -->

                <!-- Bici disponibili, selezionabili e prezzo -->

                <div class="row">
                    <div *ngFor="let bike of bikeDisponibili"
                        class="col-md-4 d-flex flex-column align-items-center justify-content-center mb-3 mb-md-0">
                        <div class="mb-2 text-break small">
                            <strong>Modello:</strong> {{ bike.idModello!.type || 'N/A' }}<br>
                            <strong>Img:</strong> {{ bike.idModello!.imgUrl || 'N/A' }}
                        </div>
                        <img [src]="bike.idModello!.imgUrl " alt="Immagine bici" class="img-fluid rounded"
                            style="max-height: 200px;" />
                    </div>
                </div>
            </div>

            <!-- Pulsanti -->
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-secondary" (click)="confirmGoBack()">Indietro</button>
                <button class="btn my-red-btn bai-jamjuree-semibold">Prenota</button>
            </div>
        </div>
    </div>
</div>
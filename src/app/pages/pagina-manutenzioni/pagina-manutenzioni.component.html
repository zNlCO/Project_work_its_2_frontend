<div class="page-container dark-theme gestione-manutenzione-page">
  <header class="page-header">
    <h1><i class="fas fa-tools"></i> Gestione Manutenzione e Disponibilità</h1>
  </header>

  <section class="action-bar">
    <div class="filter-group">
      <label for="locationFilter">Seleziona un Punto Vendita per gestire l'inventario:</label>
      <select id="locationFilter" class="custom-select dark-select" [(ngModel)]="selectedLocationId" (ngModelChange)="onLocationChange()">
        <option *ngFor="let location of locations" [value]="location.id">
          {{ location.name }}
        </option>
      </select>
    </div>
  </section>

  <section class="content-area">
    <div class="inventory-header">
      <h2>Inventario per: <span class="location-name">{{ selectedLocationName }}</span></h2>
      <p>Modifica il numero di bici "In Manutenzione" per aggiornare la disponibilità per i noleggi.</p>
    </div>

    <div class="table-responsive-container">
      <table class="data-table dark-table maintenance-table">
        <thead>
          <tr>
            <th>Nome Modello</th>
            <th>Propulsione</th>
            <th>Quantità Totale</th>
            <th>Attualmente Noleggiate</th>
            <th class="maintenance-column">In Manutenzione</th>
            <th class="availability-column">Disponibili per Noleggio</th>
            <th class="actions-column">Azione</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bike of currentInventory">
            <td>{{ bike.modelName }}</td>
            <td>{{ bike.propulsion }}</td>
            <td class="text-center">{{ bike.totalQuantity }}</td>
            <td class="text-center">{{ bike.currentlyRented }}</td>
            <td class="maintenance-cell">
              <input 
                type="number" 
                min="0" 
                [max]="getMaxMaintenanceValue(bike)" 
                class="maintenance-input dark-input"
                [(ngModel)]="bike.inMaintenance">
            </td>
            <td 
              class="availability-value text-center"
              [class.text-danger]="getAvailability(bike) < 0">
              {{ getAvailability(bike) }}
            </td>
            <td class="actions-cell">
              <button 
                class="btn btn-table-action btn-save" 
                title="Salva Modifiche"
                (click)="openSaveConfirmation(bike)"
                [disabled]="bike.inMaintenance === bike.originalInMaintenance">
                <i class="fas fa-save"></i> <span class="btn-action-text">Salva</span>
              </button>
            </td>
          </tr>
          <tr *ngIf="currentInventory.length === 0">
            <td colspan="7" class="text-center">Nessun dato di inventario disponibile per questo punto vendita.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <footer class="backoffice-page-footer dark-theme">
    <p>&copy; 2025 Bike Rental System - Backoffice</p>
  </footer>
</div>


<div class="modal-overlay" *ngIf="showConfirmationModal">
  <div class="modal-content dark-theme">
    <div class="modal-header">
      <h3>Conferma Salvataggio</h3>
    </div>
    <div class="modal-body">
      <p>Sei sicuro di voler salvare le modifiche per il modello <strong>{{ bikeToSave?.modelName }} ({{ bikeToSave?.propulsion }})</strong>?</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelSave()">Annulla</button>
      <button class="btn btn-primary" (click)="confirmSave()">Conferma e Salva</button>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showNotificationModal">
  <div class="modal-content dark-theme">
    <div class="modal-header">
      <h3 [class.text-success]="notificationSuccess" [class.text-danger]="!notificationSuccess">
        <i class="fas" [class.fa-check-circle]="notificationSuccess" [class.fa-times-circle]="!notificationSuccess"></i>
        Esito Operazione
      </h3>
    </div>
    <div class="modal-body">
      <p>{{ notificationMessage }}</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary" (click)="closeNotification()">Chiudi</button>
    </div>
  </div>
</div>